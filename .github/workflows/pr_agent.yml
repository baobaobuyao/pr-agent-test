name: PR Agent

on:
  pull_request:
    types: [opened, synchronize]
  issue_comment:
    types: [created]

jobs:
  pr_agent_job:
    runs-on: ubuntu-latest

    # --- 添加以下权限配置 ---
    permissions:
      issues: write
      pull-requests: write
      contents: write

    steps:
      - name: PR Agent action step
        uses: Codium-ai/pr-agent@main
        env:
          # --- 1. 基础认证 ---
          OPENAI_KEY: ${{ secrets.OPENAI_KEY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
          # --- 2. 核心模型配置 (使用 CONFIG_ 前缀强制覆盖) ---
          # 必须加上 "openai/" 前缀！这是强制它走 Custom URL 的暗号
          CONFIG_MODEL: "openai/deepseek-chat"
          # 强制指定 Base URL
          CONFIG_OPENAI_BASE_URL: "https://api.deepseek.com/v1"
          
          # --- 3. 关键修复：禁用回退模型 ---
          # 将回退列表设为空。这样如果 DeepSeek 失败，它会直接报出 DeepSeek 的错误，
          # 而不是去试 GPT-5 导致误导性的报错。
          CONFIG_FALLBACK_MODELS: '[]'
          
          # --- 4. 语言设置 ---
          CONFIG_FALLBACK_USER_LANGUAGE: "zh"
          
          # --- 5. 触发逻辑配置 ---
          # 开启推代码自动描述
          GITHUB_ACTION_CONFIG_AUTO_DESCRIBE: "true"
          # 允许覆盖已有描述
          PR_DESCRIPTION_IF_EXIST_DO_NOTHING: "false"
